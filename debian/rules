#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS = hardening=+all
DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/buildflags.mk
include /usr/share/dpkg/architecture.mk

%:
	dh $@ --parallel --with python2,python3

override_dh_auto_configure:
	dh_auto_configure -- \
	                     -DCMAKE_SKIP_INSTALL_RPATH:BOOL=ON \
	                     -DYARP_COMPILE_EXECUTABLES:BOOL=ON \
	                     -DYARP_COMPILE_BINDINGS:BOOL=ON \
	                     -DYARP_COMPILE_TESTS:BOOL=OFF \
	                     -DYARP_COMPILE_UNMAINTAINED:BOOL=OFF \
	                     -DCREATE_LIB_MATH:BOOL=ON \
	                     -DCREATE_GUIS:BOOL=ON \
	                     -DCREATE_YARPLASERSCANNERGUI:BOOL=ON \
	                     -DCREATE_YARPBATTERYGUI:BOOL=ON \
	                     -DCREATE_OPTIONAL_CARRIERS:BOOL=ON \
	                     -DENABLE_yarpcar_bayer:BOOL=ON \
	                     -DENABLE_yarpcar_human:BOOL=ON \
	                     -DENABLE_yarpcar_mjpeg:BOOL=ON \
	                     -DENABLE_yarpcar_mpi:BOOL=ON \
	                     -DENABLE_yarpcar_mpibcast:BOOL=ON \
	                     -DENABLE_yarpcar_portmonitor:BOOL=ON \
	                     -DENABLE_yarpcar_priority:BOOL=ON \
	                     -DENABLE_yarpcar_rossrv:BOOL=ON \
	                     -DENABLE_yarpcar_tcpros:BOOL=ON \
	                     -DENABLE_yarpcar_xmlrpc:BOOL=ON \
	                     -DCREATE_DEVICE_LIBRARY_MODULES:BOOL=ON \
	                     -DENABLE_yarpmod_serial:BOOL=ON \
	                     -DENABLE_yarpmod_serialport:BOOL=ON \
	                     -DENABLE_yarpmod_fakebot:BOOL=ON \
	                     -DENABLE_yarpmod_fakeIMU:BOOL=ON \
	                     -DENABLE_yarpmod_fakeLaser:BOOL=ON \
	                     -DENABLE_yarpmod_fakeMotionControl:BOOL=ON \
	                     -DENABLE_yarpmod_ffmpeg_grabber:BOOL=ON \
	                     -DENABLE_yarpmod_ffmpeg_writer:BOOL=ON \
	                     -DENABLE_yarpmod_imuBosch_BNO055:BOOL=ON \
	                     -DENABLE_yarpmod_laserHokuyo:BOOL=ON \
	                     -DENABLE_yarpmod_microphone:BOOL=ON \
	                     -DENABLE_yarpmod_opencv_grabber:BOOL=ON \
	                     -DENABLE_yarpmod_portaudio:BOOL=ON \
	                     -DENABLE_yarpmod_rpLidar:BOOL=ON \
	                     -DENABLE_yarpmod_SerialServoBoard:BOOL=ON \
	                     -DENABLE_yarpmod_test_grabber:BOOL=ON \
	                     -DCREATE_PERL:BOOL=ON \
	                     -DCREATE_PYTHON2:BOOL=ON \
	                     -DCREATE_PYTHON3:BOOL=ON \
	                     -DYARP_DOXYGEN_HTML:BOOL=ON \
	                     -DYARP_DOXYGEN_MAN:BOOL=ON \
# -DENABLE_yarpcar_depthimage:BOOL=ON \
# -DENABLE_yarpmod_fakeDepthCamera:BOOL=ON \
# -DENABLE_yarpmod_fakeAnalogSensor:BOOL=ON \
# -DENABLE_yarpmod_laserFromDepth:BOOL=ON \
# -DENABLE_yarpmod_rpLidar2:BOOL=ON \
# -DENABLE_yarpmod_yarpmod_SDLJoypad:BOOL=ON \
# -DENABLE_yarpmod_KinectDeviceClient:BOOL=ON \
# -DENABLE_yarpmod_KinectDeviceLocal:BOOL=ON \
# -DENABLE_yarpmod_SerialServoBoard:BOOL=ON \
# -DENABLE_yarpmod_cuda:BOOL=ON \
# -DENABLE_yarpmod_dimax_u2c:BOOL=ON \
# -DENABLE_yarpmod_dynamixelAX12Ft:BOOL=ON \
# -DENABLE_yarpmod_jrkerr:BOOL=ON \
# -DENABLE_yarpmod_nvidia:BOOL=ON \
# -DENABLE_yarpmod_stage:BOOL=ON \
# -DENABLE_yarpmod_urbtc:BOOL=ON \
# -DENABLE_yarpmod_vfw_grabber:BOOL=ON \
# -DENABLE_yarpmod_wxsdl:BOOL=ON \


override_dh_auto_build-arch:
	dh_auto_build --parallel

override_dh_auto_build-indep:
	dh_auto_build -- dox

# Do not run tests, as they fall into race conditions sometimes
override_dh_auto_test:

override_dh_strip:
	dh_strip --dbg-package=yarp-dbg

override_dh_install:
	dh_install --list-missing

override_dh_installdocs:
	dh_installdocs #--link-doc=yarp-doc
	dh_doxygen --package=yarp-doc
